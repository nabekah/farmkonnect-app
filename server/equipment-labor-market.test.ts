import { describe, it, expect, beforeEach } from 'vitest';\nimport { EquipmentManager } from './equipment';\nimport { LaborTaskManager } from './labor-tasks';\nimport { MarketPriceManager } from './market-prices';\n\n/**\n * Equipment Manager Tests\n */\ndescribe('Equipment Manager', () => {\n  let manager: EquipmentManager;\n\n  beforeEach(() => {\n    manager = new EquipmentManager();\n  });\n\n  it('should register equipment', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    expect(equipment).not.toBeNull();\n    expect(equipment.name).toBe('Tractor');\n    expect(equipment.status).toBe('operational');\n  });\n\n  it('should get equipment by farm', () => {\n    manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const equipment = manager.getEquipmentByFarm('farm-1');\n    expect(equipment.length).toBe(1);\n  });\n\n  it('should update equipment status', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const updated = manager.updateEquipmentStatus(equipment.id, 'maintenance');\n    expect(updated?.status).toBe('maintenance');\n  });\n\n  it('should record maintenance', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const record = manager.recordMaintenance(\n      equipment.id,\n      'farm-1',\n      'routine',\n      'Oil change and filter replacement',\n      150,\n      'John Smith',\n      [{ name: 'Oil Filter', quantity: 1, cost: 25 }],\n      2,\n      'Regular maintenance'\n    );\n\n    expect(record).not.toBeNull();\n    expect(record.type).toBe('routine');\n    expect(record.cost).toBe(150);\n  });\n\n  it('should record fuel log', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const log = manager.recordFuelLog(equipment.id, 'farm-1', 50, 75, 8, 'Field A', 'Refueled');\n    expect(log).not.toBeNull();\n    expect(log.amount).toBe(50);\n  });\n\n  it('should record equipment usage', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const usage = manager.recordEquipmentUsage(\n      equipment.id,\n      'farm-1',\n      'field-1',\n      8,\n      40,\n      'Plowing',\n      'John Doe'\n    );\n\n    expect(usage).not.toBeNull();\n    expect(usage.hoursUsed).toBe(8);\n  });\n\n  it('should calculate equipment costs', () => {\n    const equipment = manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    manager.recordMaintenance(\n      equipment.id,\n      'farm-1',\n      'routine',\n      'Oil change',\n      150,\n      'John Smith',\n      [],\n      2\n    );\n\n    manager.recordFuelLog(equipment.id, 'farm-1', 50, 75, 8, 'Field A');\n    manager.recordEquipmentUsage(equipment.id, 'farm-1', 'field-1', 8, 40, 'Plowing', 'John Doe');\n\n    const costs = manager.calculateEquipmentCosts(equipment.id);\n    expect(costs.totalOperatingCost).toBeGreaterThan(0);\n    expect(costs.costPerHour).toBeGreaterThan(0);\n  });\n\n  it('should get statistics', () => {\n    manager.registerEquipment(\n      'farm-1',\n      'Tractor',\n      'Tractor',\n      'John Deere',\n      'JD 7530',\n      Date.now() - 365 * 86400000,\n      50000,\n      'diesel',\n      100,\n      'Field A'\n    );\n\n    const stats = manager.getStatistics();\n    expect(stats.totalEquipment).toBeGreaterThan(0);\n    expect(stats.operationalEquipment).toBeGreaterThan(0);\n  });\n});\n\n/**\n * Labor & Task Manager Tests\n */\ndescribe('Labor & Task Manager', () => {\n  let manager: LaborTaskManager;\n\n  beforeEach(() => {\n    manager = new LaborTaskManager();\n  });\n\n  it('should register worker', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15,\n      ['plowing', 'harvesting']\n    );\n\n    expect(worker).not.toBeNull();\n    expect(worker.name).toBe('John Doe');\n    expect(worker.hourlyRate).toBe(15);\n  });\n\n  it('should create task', () => {\n    const task = manager.createTask(\n      'farm-1',\n      'field-1',\n      'Plow field',\n      'Plow the north field',\n      'high',\n      Date.now() + 86400000,\n      8,\n      'manager-1',\n      'wheat'\n    );\n\n    expect(task).not.toBeNull();\n    expect(task.title).toBe('Plow field');\n    expect(task.status).toBe('pending');\n  });\n\n  it('should assign task to worker', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    const task = manager.createTask(\n      'farm-1',\n      'field-1',\n      'Plow field',\n      'Plow the north field',\n      'high',\n      Date.now() + 86400000,\n      8,\n      'manager-1'\n    );\n\n    const assigned = manager.assignTask(task.id, worker.id);\n    expect(assigned?.assignedTo).toBe(worker.id);\n    expect(assigned?.status).toBe('assigned');\n  });\n\n  it('should complete task', () => {\n    const task = manager.createTask(\n      'farm-1',\n      'field-1',\n      'Plow field',\n      'Plow the north field',\n      'high',\n      Date.now() + 86400000,\n      8,\n      'manager-1'\n    );\n\n    manager.startTask(task.id);\n    const completed = manager.completeTask(task.id, 7.5);\n\n    expect(completed?.status).toBe('completed');\n    expect(completed?.actualHours).toBe(7.5);\n  });\n\n  it('should record time log', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    const startTime = Date.now();\n    const endTime = startTime + 8 * 3600000; // 8 hours\n\n    const log = manager.recordTimeLog(\n      'farm-1',\n      worker.id,\n      'task-1',\n      startTime,\n      endTime,\n      30,\n      'Completed plowing'\n    );\n\n    expect(log).not.toBeNull();\n    expect(log.hoursWorked).toBeCloseTo(7.5, 0.1);\n  });\n\n  it('should schedule shift', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    const shift = manager.scheduleShift(\n      'farm-1',\n      worker.id,\n      Date.now(),\n      Date.now() + 28800000, // 8 hours\n      ['task-1', 'task-2']\n    );\n\n    expect(shift).not.toBeNull();\n    expect(shift.duration).toBe(8);\n  });\n\n  it('should generate payroll', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    const startTime = Date.now();\n    const endTime = startTime + 8 * 3600000;\n\n    manager.recordTimeLog('farm-1', worker.id, 'task-1', startTime, endTime, 0);\n\n    const periodStart = Date.now() - 7 * 86400000;\n    const periodEnd = Date.now();\n\n    const payroll = manager.generatePayroll('farm-1', worker.id, periodStart, periodEnd);\n\n    expect(payroll).not.toBeNull();\n    expect(payroll.regularHours).toBeGreaterThan(0);\n    expect(payroll.netPay).toBeGreaterThan(0);\n  });\n\n  it('should calculate labor costs', () => {\n    const worker = manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    const startTime = Date.now();\n    const endTime = startTime + 8 * 3600000;\n\n    manager.recordTimeLog('farm-1', worker.id, 'task-1', startTime, endTime, 0);\n\n    const costs = manager.calculateLaborCosts(worker.id);\n    expect(costs.totalHours).toBeGreaterThan(0);\n    expect(costs.totalPay).toBeGreaterThan(0);\n  });\n\n  it('should get statistics', () => {\n    manager.registerWorker(\n      'farm-1',\n      'John Doe',\n      'john@example.com',\n      '555-1234',\n      'operator',\n      15\n    );\n\n    manager.createTask(\n      'farm-1',\n      'field-1',\n      'Plow field',\n      'Plow the north field',\n      'high',\n      Date.now() + 86400000,\n      8,\n      'manager-1'\n    );\n\n    const stats = manager.getStatistics('farm-1');\n    expect(stats.totalWorkers).toBeGreaterThan(0);\n    expect(stats.totalTasks).toBeGreaterThan(0);\n  });\n});\n\n/**\n * Market Price Manager Tests\n */\ndescribe('Market Price Manager', () => {\n  let manager: MarketPriceManager;\n\n  beforeEach(() => {\n    manager = new MarketPriceManager();\n  });\n\n  it('should record commodity price', () => {\n    const price = manager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n\n    expect(price).not.toBeNull();\n    expect(price.commodity).toBe('wheat');\n    expect(price.price).toBe(250);\n  });\n\n  it('should get latest price', () => {\n    manager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n\n    const latest = manager.getLatestPrice('wheat');\n    expect(latest).not.toBeNull();\n    expect(latest?.price).toBe(250);\n  });\n\n  it('should generate price forecast', () => {\n    manager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n\n    const forecast = manager.generatePriceForecast('wheat', 30);\n    expect(forecast).not.toBeNull();\n    expect(forecast.predictions.length).toBe(30);\n  });\n\n  it('should record farm production', () => {\n    const production = manager.recordFarmProduction(\n      'farm-1',\n      'wheat',\n      5000,\n      'per_kg',\n      Date.now() - 86400000,\n      'Good harvest'\n    );\n\n    expect(production).not.toBeNull();\n    expect(production.quantity).toBe(5000);\n    expect(production.estimatedValue).toBeGreaterThan(0);\n  });\n\n  it('should record sale', () => {\n    const sale = manager.recordSale(\n      'farm-1',\n      'wheat',\n      5000,\n      'per_kg',\n      250,\n      'Buyer Inc',\n      'favorable',\n      'Good price'\n    );\n\n    expect(sale).not.toBeNull();\n    expect(sale.totalPrice).toBe(1250000);\n  });\n\n  it('should create price alert', () => {\n    const alert = manager.createPriceAlert('farm-1', 'wheat', 280, 'above');\n\n    expect(alert).not.toBeNull();\n    expect(alert.triggerPrice).toBe(280);\n    expect(alert.isActive).toBe(true);\n  });\n\n  it('should analyze market', () => {\n    manager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n\n    const analysis = manager.analyzeMarket('wheat');\n    expect(analysis).not.toBeNull();\n    expect(analysis.commodity).toBe('wheat');\n    expect(analysis.recommendation).toBeDefined();\n  });\n\n  it('should get statistics', () => {\n    manager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n    manager.recordFarmProduction('farm-1', 'wheat', 5000, 'per_kg', Date.now());\n    manager.recordSale('farm-1', 'wheat', 5000, 'per_kg', 250, 'Buyer Inc', 'favorable');\n\n    const stats = manager.getStatistics();\n    expect(stats.totalPriceRecords).toBeGreaterThan(0);\n    expect(stats.totalRevenue).toBeGreaterThan(0);\n  });\n});\n\n/**\n * Integration Tests\n */\ndescribe('Integration Tests', () => {\n  it('should work with all three systems together', () => {\n    const equipmentManager = new EquipmentManager();\n    const laborManager = new LaborTaskManager();\n    const marketManager = new MarketPriceManager();\n\n    // Register equipment\n    const equipment = equipmentManager.registerEquipment(\n      'farm-1',\n      'Harvester',\n      'Harvester',\n      'John Deere',\n      'JD 9600',\n      Date.now() - 365 * 86400000,\n      100000,\n      'diesel',\n      150,\n      'Field A'\n    );\n\n    // Register worker\n    const worker = laborManager.registerWorker(\n      'farm-1',\n      'Jane Smith',\n      'jane@example.com',\n      '555-5678',\n      'operator',\n      20,\n      ['harvesting']\n    );\n\n    // Create task\n    const task = laborManager.createTask(\n      'farm-1',\n      'field-1',\n      'Harvest wheat',\n      'Harvest the wheat field',\n      'high',\n      Date.now() + 86400000,\n      10,\n      'manager-1',\n      'wheat',\n      [equipment.id]\n    );\n\n    // Assign task\n    laborManager.assignTask(task.id, worker.id);\n\n    // Record equipment usage\n    equipmentManager.recordEquipmentUsage(\n      equipment.id,\n      'farm-1',\n      'field-1',\n      10,\n      60,\n      'Harvesting',\n      worker.name\n    );\n\n    // Record market data\n    marketManager.recordCommodityPrice('wheat', 250, 'per_kg', 'Market Feed', 'Primary', 10000, 2.5);\n\n    // Record production\n    const production = marketManager.recordFarmProduction(\n      'farm-1',\n      'wheat',\n      10000,\n      'per_kg',\n      Date.now(),\n      'Harvested from field-1'\n    );\n\n    // Record sale\n    const sale = marketManager.recordSale(\n      'farm-1',\n      'wheat',\n      10000,\n      'per_kg',\n      250,\n      'Buyer Inc',\n      'favorable'\n    );\n\n    // Verify all systems\n    expect(equipment).not.toBeNull();\n    expect(worker).not.toBeNull();\n    expect(task).not.toBeNull();\n    expect(production).not.toBeNull();\n    expect(sale).not.toBeNull();\n    expect(sale.totalPrice).toBe(2500000);\n  });\n});\n
