import { EventEmitter } from 'events';\n\nexport type SocialPlatform = 'twitter' | 'facebook' | 'linkedin' | 'instagram' | 'email';\nexport type ShareableContent = 'achievement' | 'report' | 'farm_update' | 'milestone' | 'harvest';\n\nexport interface Achievement {\n  id: string;\n  userId: string;\n  type: string;\n  title: string;\n  description: string;\n  icon: string;\n  earnedAt: number;\n  points: number;\n  shareable: boolean;\n}\n\nexport interface ShareableItem {\n  id: string;\n  userId: string;\n  contentType: ShareableContent;\n  title: string;\n  description: string;\n  imageUrl?: string;\n  data: Record<string, any>;\n  createdAt: number;\n  isPublic: boolean;\n  shareToken?: string;\n}\n\nexport interface SocialShare {\n  id: string;\n  itemId: string;\n  userId: string;\n  platform: SocialPlatform;\n  sharedAt: number;\n  url?: string;\n  status: 'pending' | 'shared' | 'failed';\n  engagement?: {\n    likes: number;\n    comments: number;\n    shares: number;\n    views: number;\n  };\n}\n\nexport interface FarmInvitation {\n  id: string;\n  farmId: string;\n  invitedBy: string;\n  invitedUser?: string;\n  invitedEmail?: string;\n  role: 'viewer' | 'editor' | 'admin';\n  status: 'pending' | 'accepted' | 'declined';\n  createdAt: number;\n  expiresAt: number;\n  invitationToken: string;\n}\n\nexport interface ShareMetrics {\n  itemId: string;\n  totalShares: number;\n  sharesByPlatform: Record<SocialPlatform, number>;\n  totalEngagement: number;\n  topPerformingPlatform: SocialPlatform | null;\n}\n\n/**\n * Social Sharing Manager\n */\nexport class SocialSharingManager extends EventEmitter {\n  private achievements: Map<string, Achievement> = new Map();\n  private shareableItems: Map<string, ShareableItem> = new Map();\n  private socialShares: Map<string, SocialShare> = new Map();\n  private farmInvitations: Map<string, FarmInvitation> = new Map();\n  private shareMetrics: Map<string, ShareMetrics> = new Map();\n  private userConnections: Map<string, Set<string>> = new Map();\n\n  constructor(private baseUrl: string = 'https://farmkonnect.com') {\n    super();\n  }\n\n  /**\n   * Award achievement\n   */\n  awardAchievement(\n    userId: string,\n    type: string,\n    title: string,\n    description: string,\n    points: number = 10\n  ): Achievement {\n    const achievementId = `ach_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    const achievement: Achievement = {\n      id: achievementId,\n      userId,\n      type,\n      title,\n      description,\n      icon: this.getAchievementIcon(type),\n      earnedAt: Date.now(),\n      points,\n      shareable: true,\n    };\n\n    this.achievements.set(achievementId, achievement);\n    this.emit('achievement:awarded', { userId, type, points });\n    return achievement;\n  }\n\n  /**\n   * Get achievement icon\n   */\n  private getAchievementIcon(type: string): string {\n    const icons: Record<string, string> = {\n      first_harvest: 'ðŸŒ¾',\n      high_yield: 'ðŸ“ˆ',\n      sustainable: 'ðŸŒ±',\n      team_builder: 'ðŸ‘¥',\n      data_master: 'ðŸ“Š',\n      weather_expert: 'ðŸŒ¤ï¸',\n    };\n    return icons[type] || 'â­';\n  }\n\n  /**\n   * Get user achievements\n   */\n  getUserAchievements(userId: string): Achievement[] {\n    return Array.from(this.achievements.values()).filter((a) => a.userId === userId);\n  }\n\n  /**\n   * Create shareable item\n   */\n  createShareableItem(\n    userId: string,\n    contentType: ShareableContent,\n    title: string,\n    description: string,\n    data: Record<string, any>,\n    imageUrl?: string,\n    isPublic: boolean = true\n  ): ShareableItem {\n    const itemId = `share_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const shareToken = this.generateShareToken();\n\n    const item: ShareableItem = {\n      id: itemId,\n      userId,\n      contentType,\n      title,\n      description,\n      imageUrl,\n      data,\n      createdAt: Date.now(),\n      isPublic,\n      shareToken,\n    };\n\n    this.shareableItems.set(itemId, item);\n    this.shareMetrics.set(itemId, {\n      itemId,\n      totalShares: 0,\n      sharesByPlatform: {\n        twitter: 0,\n        facebook: 0,\n        linkedin: 0,\n        instagram: 0,\n        email: 0,\n      },\n      totalEngagement: 0,\n      topPerformingPlatform: null,\n    });\n\n    this.emit('item:created', { itemId, contentType });\n    return item;\n  }\n\n  /**\n   * Get shareable item\n   */\n  getShareableItem(itemId: string): ShareableItem | null {\n    return this.shareableItems.get(itemId) || null;\n  }\n\n  /**\n   * Share to social platform\n   */\n  shareToSocialPlatform(itemId: string, userId: string, platform: SocialPlatform): SocialShare {\n    const item = this.shareableItems.get(itemId);\n    if (!item) throw new Error('Shareable item not found');\n\n    const shareId = `soc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const shareUrl = `${this.baseUrl}/share/${item.shareToken}`;\n\n    const share: SocialShare = {\n      id: shareId,\n      itemId,\n      userId,\n      platform,\n      sharedAt: Date.now(),\n      url: shareUrl,\n      status: 'pending',\n      engagement: {\n        likes: 0,\n        comments: 0,\n        shares: 0,\n        views: 0,\n      },\n    };\n\n    this.socialShares.set(shareId, share);\n\n    // Update metrics\n    const metrics = this.shareMetrics.get(itemId);\n    if (metrics) {\n      metrics.totalShares++;\n      metrics.sharesByPlatform[platform]++;\n    }\n\n    this.emit('share:created', { shareId, itemId, platform });\n    return share;\n  }\n\n  /**\n   * Update share engagement\n   */\n  updateShareEngagement(\n    shareId: string,\n    likes: number,\n    comments: number,\n    shares: number,\n    views: number\n  ): SocialShare {\n    const share = this.socialShares.get(shareId);\n    if (!share) throw new Error('Share not found');\n\n    if (share.engagement) {\n      share.engagement.likes = likes;\n      share.engagement.comments = comments;\n      share.engagement.shares = shares;\n      share.engagement.views = views;\n    }\n\n    share.status = 'shared';\n\n    // Update metrics\n    const metrics = this.shareMetrics.get(share.itemId);\n    if (metrics) {\n      metrics.totalEngagement = (likes + comments + shares) * 2 + views;\n    }\n\n    this.emit('engagement:updated', { shareId, totalEngagement: metrics?.totalEngagement });\n    return share;\n  }\n\n  /**\n   * Get share metrics\n   */\n  getShareMetrics(itemId: string): ShareMetrics | null {\n    return this.shareMetrics.get(itemId) || null;\n  }\n\n  /**\n   * Create farm invitation\n   */\n  createFarmInvitation(\n    farmId: string,\n    invitedBy: string,\n    invitedEmail: string,\n    role: 'viewer' | 'editor' | 'admin' = 'viewer',\n    expiresInDays: number = 7\n  ): FarmInvitation {\n    const invitationId = `inv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const invitationToken = this.generateShareToken();\n\n    const invitation: FarmInvitation = {\n      id: invitationId,\n      farmId,\n      invitedBy,\n      invitedEmail,\n      role,\n      status: 'pending',\n      createdAt: Date.now(),\n      expiresAt: Date.now() + expiresInDays * 86400000,\n      invitationToken,\n    };\n\n    this.farmInvitations.set(invitationId, invitation);\n    this.emit('invitation:created', { invitationId, farmId, invitedEmail });\n    return invitation;\n  }\n\n  /**\n   * Accept farm invitation\n   */\n  acceptFarmInvitation(invitationId: string, userId: string): FarmInvitation {\n    const invitation = this.farmInvitations.get(invitationId);\n    if (!invitation) throw new Error('Invitation not found');\n    if (invitation.status !== 'pending') throw new Error('Invitation already processed');\n    if (Date.now() > invitation.expiresAt) throw new Error('Invitation expired');\n\n    invitation.status = 'accepted';\n    invitation.invitedUser = userId;\n\n    this.emit('invitation:accepted', { invitationId, userId, farmId: invitation.farmId });\n    return invitation;\n  }\n\n  /**\n   * Decline farm invitation\n   */\n  declineFarmInvitation(invitationId: string): FarmInvitation {\n    const invitation = this.farmInvitations.get(invitationId);\n    if (!invitation) throw new Error('Invitation not found');\n\n    invitation.status = 'declined';\n    this.emit('invitation:declined', { invitationId });\n    return invitation;\n  }\n\n  /**\n   * Get pending invitations for user\n   */\n  getPendingInvitations(email: string): FarmInvitation[] {\n    return Array.from(this.farmInvitations.values()).filter(\n      (inv) => inv.invitedEmail === email && inv.status === 'pending' && Date.now() < inv.expiresAt\n    );\n  }\n\n  /**\n   * Generate share token\n   */\n  private generateShareToken(): string {\n    return `${Math.random().toString(36).substr(2, 9)}_${Date.now().toString(36)}`;\n  }\n\n  /**\n   * Get social sharing stats\n   */\n  getSocialSharingStats(userId?: string): {\n    totalShares: number;\n    totalEngagement: number;\n    sharesByPlatform: Record<SocialPlatform, number>;\n    topContent: ShareableItem | null;\n    averageEngagementPerShare: number;\n  } {\n    let totalShares = 0;\n    let totalEngagement = 0;\n    const sharesByPlatform: Record<SocialPlatform, number> = {\n      twitter: 0,\n      facebook: 0,\n      linkedin: 0,\n      instagram: 0,\n      email: 0,\n    };\n\n    let topContent: ShareableItem | null = null;\n    let topEngagement = 0;\n\n    for (const share of this.socialShares.values()) {\n      if (userId && share.userId !== userId) continue;\n\n      totalShares++;\n      sharesByPlatform[share.platform]++;\n\n      if (share.engagement) {\n        const engagement = (share.engagement.likes + share.engagement.comments) * 2 + share.engagement.views;\n        totalEngagement += engagement;\n\n        if (engagement > topEngagement) {\n          topEngagement = engagement;\n          topContent = this.shareableItems.get(share.itemId) || null;\n        }\n      }\n    }\n\n    const averageEngagementPerShare = totalShares > 0 ? totalEngagement / totalShares : 0;\n\n    return {\n      totalShares,\n      totalEngagement,\n      sharesByPlatform,\n      topContent,\n      averageEngagementPerShare: Math.round(averageEngagementPerShare),\n    };\n  }\n}\n
