import { describe, it, expect, beforeEach } from 'vitest';\nimport { PushNotificationsManager } from './push-notifications';\nimport { ApiDocumentationManager } from './api-documentation';\n\n/**\n * Push Notifications Tests\n */\ndescribe('Push Notifications Manager', () => {\n  let notificationManager: PushNotificationsManager;\n\n  beforeEach(() => {\n    notificationManager = new PushNotificationsManager();\n  });\n\n  it('should register recipient', () => {\n    const recipient = notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n      phoneNumber: '+1234567890',\n      pushToken: 'token-123',\n    });\n\n    expect(recipient).not.toBeNull();\n    expect(recipient.userId).toBe('user-1');\n    expect(recipient.email).toBe('user@example.com');\n  });\n\n  it('should send notification', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n\n    const notification = await notificationManager.sendNotification(\n      'user-1',\n      'Test Alert',\n      'This is a test notification',\n      ['email', 'push'],\n      'high'\n    );\n\n    expect(notification).not.toBeNull();\n    expect(notification.status).toBe('pending');\n    expect(notification.title).toBe('Test Alert');\n  });\n\n  it('should send from template', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n\n    const notification = await notificationManager.sendFromTemplate('user-1', 'alert-high-temp', {\n      farmName: 'North Field',\n      threshold: 35,\n      currentTemp: 38,\n    });\n\n    expect(notification).not.toBeNull();\n    expect(notification.title).toContain('High Temperature');\n  });\n\n  it('should get templates', () => {\n    const templates = notificationManager.getTemplates();\n    expect(templates.length).toBeGreaterThan(0);\n    expect(templates.some((t) => t.id === 'alert-high-temp')).toBe(true);\n  });\n\n  it('should get notification by id', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n\n    const sent = await notificationManager.sendNotification(\n      'user-1',\n      'Test',\n      'Test notification',\n      ['email']\n    );\n\n    const retrieved = notificationManager.getNotification(sent.id);\n    expect(retrieved).not.toBeNull();\n    expect(retrieved?.id).toBe(sent.id);\n  });\n\n  it('should get notifications by user', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n    notificationManager.registerRecipient('user-2', {\n      email: 'user2@example.com',\n    });\n\n    await notificationManager.sendNotification('user-1', 'Alert 1', 'Test', ['email']);\n    await notificationManager.sendNotification('user-1', 'Alert 2', 'Test', ['email']);\n    await notificationManager.sendNotification('user-2', 'Alert 3', 'Test', ['email']);\n\n    const user1Notifications = notificationManager.getNotificationsByUser('user-1');\n    expect(user1Notifications.length).toBe(2);\n  });\n\n  it('should get notification stats', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n\n    await notificationManager.sendNotification('user-1', 'Alert', 'Test', ['email']);\n\n    const stats = notificationManager.getNotificationStats();\n    expect(stats.totalPending).toBeGreaterThan(0);\n  });\n\n  it('should respect do not disturb settings', async () => {\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n      preferences: {\n        channels: ['email'],\n        doNotDisturb: true,\n        doNotDisturbStart: 22,\n        doNotDisturbEnd: 8,\n      },\n    });\n\n    const notification = await notificationManager.sendNotification(\n      'user-1',\n      'Alert',\n      'Test',\n      ['email']\n    );\n\n    expect(notification).not.toBeNull();\n  });\n});\n\n/**\n * API Documentation Tests\n */\ndescribe('API Documentation Manager', () => {\n  let docManager: ApiDocumentationManager;\n\n  beforeEach(() => {\n    docManager = new ApiDocumentationManager('https://api.farmkonnect.com');\n  });\n\n  it('should have default endpoints', () => {\n    const endpoints = docManager.getAllEndpoints();\n    expect(endpoints.length).toBeGreaterThan(0);\n  });\n\n  it('should get endpoint by id', () => {\n    const endpoint = docManager.getEndpoint('farms-list');\n    expect(endpoint).not.toBeNull();\n    expect(endpoint?.method).toBe('GET');\n    expect(endpoint?.path).toBe('/api/farms');\n  });\n\n  it('should get endpoints by tag', () => {\n    const endpoints = docManager.getEndpointsByTag('Farms');\n    expect(endpoints.length).toBeGreaterThan(0);\n    expect(endpoints.some((e) => e.id === 'farms-list')).toBe(true);\n  });\n\n  it('should register new endpoint', () => {\n    docManager.registerEndpoint({\n      id: 'test-endpoint',\n      method: 'GET',\n      path: '/api/test',\n      summary: 'Test endpoint',\n      description: 'A test endpoint',\n      tags: ['Test'],\n      parameters: [],\n      responses: [{ status: 200, description: 'Success' }],\n    });\n\n    const endpoint = docManager.getEndpoint('test-endpoint');\n    expect(endpoint).not.toBeNull();\n    expect(endpoint?.path).toBe('/api/test');\n  });\n\n  it('should generate OpenAPI spec', () => {\n    const spec = docManager.generateOpenAPISpec();\n    expect(spec.openapi).toBe('3.0.0');\n    expect(spec.info.title).toBe('FarmKonnect API');\n    expect(spec.paths).not.toBeNull();\n    expect(Object.keys(spec.paths).length).toBeGreaterThan(0);\n  });\n\n  it('should generate HTML documentation', () => {\n    const html = docManager.generateHTMLDocumentation();\n    expect(html).toContain('FarmKonnect API Documentation');\n    expect(html).toContain('GET');\n    expect(html).toContain('/api/farms');\n  });\n\n  it('should generate Markdown documentation', () => {\n    const md = docManager.generateMarkdownDocumentation();\n    expect(md).toContain('FarmKonnect API Documentation');\n    expect(md).toContain('GET');\n    expect(md).toContain('/api/farms');\n  });\n\n  it('should log API access', () => {\n    docManager.logAccess('farms-list', 'user-1');\n    docManager.logAccess('tasks-list', 'user-2');\n    docManager.logAccess('farms-list', 'user-1');\n\n    const stats = docManager.getAccessStats();\n    expect(stats.totalAccesses).toBe(3);\n    expect(stats.byEndpoint['farms-list']).toBe(2);\n  });\n\n  it('should get access statistics', () => {\n    docManager.logAccess('farms-list');\n    docManager.logAccess('tasks-list');\n\n    const stats = docManager.getAccessStats();\n    expect(stats.totalAccesses).toBe(2);\n    expect(stats.last24Hours).toBe(2);\n  });\n\n  it('should have all tags', () => {\n    const tags = docManager.getAllTags();\n    expect(tags.length).toBeGreaterThan(0);\n    expect(tags.some((t) => t.name === 'Farms')).toBe(true);\n  });\n});\n\n/**\n * Integration Tests\n */\ndescribe('Integration Tests', () => {\n  it('should work with notifications and documentation', async () => {\n    const notificationManager = new PushNotificationsManager();\n    const docManager = new ApiDocumentationManager();\n\n    // Register recipient\n    notificationManager.registerRecipient('user-1', {\n      email: 'user@example.com',\n    });\n\n    // Send notification\n    const notification = await notificationManager.sendNotification(\n      'user-1',\n      'API Updated',\n      'New endpoints available',\n      ['email']\n    );\n\n    // Generate documentation\n    const spec = docManager.generateOpenAPISpec();\n    const html = docManager.generateHTMLDocumentation();\n\n    // Log access\n    docManager.logAccess('farms-list', 'user-1');\n\n    // Verify all systems work\n    expect(notification).not.toBeNull();\n    expect(spec.paths).not.toBeNull();\n    expect(html).toContain('FarmKonnect');\n\n    const stats = docManager.getAccessStats();\n    expect(stats.totalAccesses).toBe(1);\n  });\n});\n
