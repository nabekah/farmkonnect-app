/**\n * Comprehensive Tests for 8 Crop Management Features\n */\n\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { cropVarietyDatabase, CropVarietyDatabase } from './crop-variety-database';\nimport { growthStageTracker, GrowthStageTracker } from './growth-stage-tracking';\nimport { yieldPredictionModel, YieldPredictionModel } from './yield-prediction-models';\nimport { pestDiseaseManager, PestDiseaseManager } from './pest-disease-management';\nimport { fertilizerRecommender, FertilizerRecommender } from './fertilizer-recommendations';\nimport { irrigationScheduler, IrrigationScheduler } from './irrigation-scheduling';\nimport { harvestPlanner, HarvestPlanner } from './harvest-planning';\nimport { cropRotationPlanner, CropRotationPlanner } from './crop-rotation-planning';\n\ndescribe('Crop Management Features', () => {\n  describe('1. Crop Variety Database', () => {\n    it('should search crop varieties by name', () => {\n      const results = cropVarietyDatabase.searchByName('rice');\n      expect(results.length).toBeGreaterThan(0);\n      expect(results[0].cropName).toBe('Rice');\n    });\n\n    it('should get varieties by season', () => {\n      const varieties = cropVarietyDatabase.getVarietiesBySeason(6);\n      expect(varieties.length).toBeGreaterThan(0);\n    });\n\n    it('should get varieties by disease resistance', () => {\n      const varieties = cropVarietyDatabase.getVarietiesByDiseaseResistance('blast');\n      expect(varieties.length).toBeGreaterThan(0);\n    });\n\n    it('should get recommended varieties', () => {\n      const recommended = cropVarietyDatabase.getRecommendedVarieties('loam', 6, 'South Asia');\n      expect(recommended.length).toBeGreaterThan(0);\n      expect(recommended[0].characteristics.yieldPotential).toBeGreaterThanOrEqual(recommended[1]?.characteristics.yieldPotential || 0);\n    });\n  });\n\n  describe('2. Growth Stage Tracking', () => {\n    let tracker: GrowthStageTracker;\n\n    beforeEach(() => {\n      tracker = new GrowthStageTracker();\n    });\n\n    it('should create a growth tracker', () => {\n      const cropTracker = tracker.createTracker('crop-1', 'field-1', 'rice');\n      expect(cropTracker.cropId).toBe('crop-1');\n      expect(cropTracker.currentStage).toBe(1);\n      expect(cropTracker.healthStatus).toBe('excellent');\n    });\n\n    it('should record observations', () => {\n      tracker.createTracker('crop-1', 'field-1', 'rice');\n      tracker.recordObservation('crop-1', {\n        stage: 1,\n        height: 10,\n        leafCount: 3,\n        diseaseSymptoms: [],\n        pestPresence: [],\n        notes: 'Seedling stage',\n      });\n\n      const cropTracker = tracker.getTracker('crop-1');\n      expect(cropTracker?.observations.length).toBe(1);\n    });\n\n    it('should update health status based on observations', () => {\n      tracker.createTracker('crop-1', 'field-1', 'rice');\n      tracker.recordObservation('crop-1', {\n        stage: 2,\n        height: 20,\n        leafCount: 5,\n        diseaseSymptoms: ['blast', 'sheath_blight', 'brown_spot'],\n        pestPresence: ['stem_borer', 'leaf_folder', 'plant_hopper', 'gall_midge', 'leaf_hopper'],\n        notes: 'Disease and pest pressure',\n      });\n\n      const cropTracker = tracker.getTracker('crop-1');\n      expect(cropTracker?.healthStatus).toBe('poor');\n    });\n\n    it('should predict next stage', () => {\n      tracker.createTracker('crop-1', 'field-1', 'rice');\n      const prediction = tracker.predictNextStage('crop-1');\n      expect(prediction?.stage).toBe(2);\n      expect(prediction?.daysUntil).toBeGreaterThan(0);\n    });\n  });\n\n  describe('3. Yield Prediction Models', () => {\n    it('should predict rice yield', () => {\n      const prediction = yieldPredictionModel.predictYield({\n        cropVariety: 'rice',\n        fieldArea: 1,\n        soilFertility: 75,\n        waterAvailability: 85,\n        temperature: 28,\n        rainfall: 1200,\n        sunlight: 12,\n        pestPressure: 20,\n        diseasePressure: 15,\n        fertilizerApplied: 100,\n        irrigationSchedule: 'regular',\n      });\n\n      expect(prediction.estimatedYield).toBeGreaterThan(0);\n      expect(prediction.confidence).toBeGreaterThan(50);\n      expect(prediction.factors.length).toBeGreaterThan(0);\n      expect(prediction.recommendations.length).toBeGreaterThan(0);\n    });\n\n    it('should provide lower yield with poor conditions', () => {\n      const goodPrediction = yieldPredictionModel.predictYield({\n        cropVariety: 'rice',\n        fieldArea: 1,\n        soilFertility: 75,\n        waterAvailability: 85,\n        temperature: 28,\n        rainfall: 1200,\n        sunlight: 12,\n        pestPressure: 10,\n        diseasePressure: 10,\n        fertilizerApplied: 100,\n        irrigationSchedule: 'regular',\n      });\n\n      const poorPrediction = yieldPredictionModel.predictYield({\n        cropVariety: 'rice',\n        fieldArea: 1,\n        soilFertility: 30,\n        waterAvailability: 30,\n        temperature: 15,\n        rainfall: 300,\n        sunlight: 6,\n        pestPressure: 80,\n        diseasePressure: 80,\n        fertilizerApplied: 20,\n        irrigationSchedule: 'irregular',\n      });\n\n      expect(goodPrediction.estimatedYield).toBeGreaterThan(poorPrediction.estimatedYield);\n    });\n  });\n\n  describe('4. Pest & Disease Management', () => {\n    let manager: PestDiseaseManager;\n\n    beforeEach(() => {\n      manager = new PestDiseaseManager();\n    });\n\n    it('should identify pests and diseases', () => {\n      const results = manager.identifyPestOrDisease('rice', ['white heads', 'holes in stems']);\n      expect(results.length).toBeGreaterThan(0);\n    });\n\n    it('should report an incident', () => {\n      const incident = manager.reportIncident({\n        fieldId: 'field-1',\n        cropId: 'crop-1',\n        type: 'pest',\n        name: 'rice-stem-borer',\n        severity: 'high',\n        affectedArea: 30,\n        detectionDate: new Date(),\n      });\n\n      expect(incident.id).toBeDefined();\n      expect(incident.status).toBe('detected');\n    });\n\n    it('should get treatment recommendations', () => {\n      const incident = manager.reportIncident({\n        fieldId: 'field-1',\n        cropId: 'crop-1',\n        type: 'pest',\n        name: 'rice-stem-borer',\n        severity: 'high',\n        affectedArea: 30,\n        detectionDate: new Date(),\n      });\n\n      const treatments = manager.getTreatmentRecommendations(incident.id);\n      expect(treatments.length).toBeGreaterThan(0);\n    });\n\n    it('should assess risk based on weather', () => {\n      const risk = manager.getRiskAssessment('field-1', 25, 90, 150);\n      expect(risk).toContain('Risk Level');\n    });\n  });\n\n  describe('5. Fertilizer Recommendations', () => {\n    it('should recommend fertilizers for rice', () => {\n      const recommendation = fertilizerRecommender.getRecommendation('rice', 3, {\n        nitrogen: 50,\n        phosphorus: 30,\n        potassium: 40,\n        pH: 6.5,\n        organicMatter: 2,\n        micronutrients: {\n          zinc: 2,\n          iron: 5,\n          manganese: 2,\n          copper: 1,\n          boron: 0.5,\n        },\n      });\n\n      expect(recommendation.recommendations.length).toBeGreaterThan(0);\n      expect(recommendation.totalNitrogen).toBeGreaterThan(0);\n      expect(recommendation.costEstimate).toBeGreaterThan(0);\n    });\n\n    it('should provide micronutrient applications', () => {\n      const recommendation = fertilizerRecommender.getRecommendation('wheat', 2, {\n        nitrogen: 80,\n        phosphorus: 40,\n        potassium: 30,\n        pH: 6.8,\n        organicMatter: 1.5,\n        micronutrients: {\n          zinc: 1,\n          iron: 2,\n          manganese: 1,\n          copper: 0.5,\n          boron: 0.2,\n        },\n      });\n\n      expect(recommendation.micronutrientApplications.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('6. Irrigation Scheduling', () => {\n    let scheduler: IrrigationScheduler;\n\n    beforeEach(() => {\n      scheduler = new IrrigationScheduler();\n    });\n\n    it('should generate irrigation schedule', () => {\n      const schedule = scheduler.generateSchedule(\n        'field-1',\n        'rice',\n        3,\n        60,\n        {\n          temperature: 28,\n          rainfall: 50,\n          humidity: 70,\n          windSpeed: 10,\n          evapotranspiration: 5,\n        }\n      );\n\n      expect(schedule).not.toBeNull();\n      expect(schedule?.waterRequirement).toBeGreaterThan(0);\n      expect(schedule?.recommendations.length).toBeGreaterThan(0);\n    });\n\n    it('should record soil moisture data', () => {\n      scheduler.recordSoilMoisture('field-1', 65, 30);\n      // Just verify no error\n      expect(true).toBe(true);\n    });\n  });\n\n  describe('7. Harvest Planning', () => {\n    let planner: HarvestPlanner;\n\n    beforeEach(() => {\n      planner = new HarvestPlanner();\n    });\n\n    it('should create harvest plan', () => {\n      const plan = planner.createHarvestPlan('field-1', 'rice', 5000, 1);\n      expect(plan.cropName).toBe('rice');\n      expect(plan.expectedYield).toBe(5000);\n      expect(plan.equipmentNeeded.length).toBeGreaterThan(0);\n      expect(plan.postHarvestOperations.length).toBeGreaterThan(0);\n    });\n\n    it('should check harvest readiness', () => {\n      const planner = new HarvestPlanner();\n      const isReady = planner.checkHarvestReadiness('rice', {\n        'Grain moisture': 22,\n        'Panicle bending': 90,\n        'Days to maturity': 125,\n      });\n\n      expect(typeof isReady).toBe('boolean');\n    });\n\n    it('should identify risk factors', () => {\n      const plan = planner.createHarvestPlan('field-1', 'wheat', 4500, 2);\n      expect(plan.riskFactors.length).toBeGreaterThan(0);\n      expect(plan.riskFactors[0].mitigationStrategy).toBeDefined();\n    });\n  });\n\n  describe('8. Crop Rotation Planning', () => {\n    let rotationPlanner: CropRotationPlanner;\n\n    beforeEach(() => {\n      rotationPlanner = new CropRotationPlanner();\n    });\n\n    it('should get available rotation templates', () => {\n      const templates = rotationPlanner.getAvailableTemplates();\n      expect(templates.length).toBeGreaterThan(0);\n      expect(templates[0].crops.length).toBeGreaterThan(0);\n    });\n\n    it('should create rotation plan', () => {\n      const plan = rotationPlanner.createRotationPlan('field-1', 'Rice-Wheat-Legume', {\n        nitrogenLevel: 'balanced',\n        organicMatterTrend: 'stable',\n        soilStructure: 'good',\n        microbiologicalActivity: 60,\n        compactionRisk: 40,\n      });\n\n      expect(plan).not.toBeNull();\n      expect(plan?.crops.length).toBe(3);\n      expect(plan?.diseaseRiskReduction).toBeGreaterThan(0);\n      expect(plan?.recommendations.length).toBeGreaterThan(0);\n    });\n\n    it('should assess soil impact', () => {\n      const plan = rotationPlanner.createRotationPlan('field-1', 'Rice-Wheat-Legume', {\n        nitrogenLevel: 'balanced',\n        organicMatterTrend: 'stable',\n        soilStructure: 'good',\n        microbiologicalActivity: 60,\n        compactionRisk: 40,\n      });\n\n      expect(plan?.soilImpact.nitrogenLevel).toBeDefined();\n      expect(plan?.soilImpact.organicMatterTrend).toBeDefined();\n      expect(plan?.soilImpact.soilStructure).toBeDefined();\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should work together: variety -> growth -> yield -> pest -> fertilizer -> irrigation -> harvest -> rotation', () => {\n      // Select variety\n      const varieties = cropVarietyDatabase.getVarietiesBySeason(6);\n      expect(varieties.length).toBeGreaterThan(0);\n\n      // Track growth\n      const tracker = new GrowthStageTracker();\n      const cropTracker = tracker.createTracker('crop-1', 'field-1', 'rice');\n      expect(cropTracker.currentStage).toBe(1);\n\n      // Predict yield\n      const yieldPred = yieldPredictionModel.predictYield({\n        cropVariety: 'rice',\n        fieldArea: 1,\n        soilFertility: 70,\n        waterAvailability: 80,\n        temperature: 28,\n        rainfall: 1000,\n        sunlight: 12,\n        pestPressure: 20,\n        diseasePressure: 15,\n        fertilizerApplied: 100,\n        irrigationSchedule: 'regular',\n      });\n      expect(yieldPred.estimatedYield).toBeGreaterThan(0);\n\n      // Manage pests\n      const manager = new PestDiseaseManager();\n      const pests = manager.identifyPestOrDisease('rice', ['white heads']);\n      expect(pests.length).toBeGreaterThan(0);\n\n      // Get fertilizer recommendation\n      const fert = fertilizerRecommender.getRecommendation('rice', 3, {\n        nitrogen: 60,\n        phosphorus: 30,\n        potassium: 40,\n        pH: 6.5,\n        organicMatter: 2,\n        micronutrients: {\n          zinc: 2,\n          iron: 5,\n          manganese: 2,\n          copper: 1,\n          boron: 0.5,\n        },\n      });\n      expect(fert.recommendations.length).toBeGreaterThan(0);\n\n      // Schedule irrigation\n      const scheduler = new IrrigationScheduler();\n      const irrigation = scheduler.generateSchedule('field-1', 'rice', 3, 60, {\n        temperature: 28,\n        rainfall: 50,\n        humidity: 70,\n        windSpeed: 10,\n        evapotranspiration: 5,\n      });\n      expect(irrigation).not.toBeNull();\n\n      // Plan harvest\n      const planner = new HarvestPlanner();\n      const harvest = planner.createHarvestPlan('field-1', 'rice', yieldPred.estimatedYield, 1);\n      expect(harvest.expectedYield).toBe(yieldPred.estimatedYield);\n\n      // Plan rotation\n      const rotPlanner = new CropRotationPlanner();\n      const rotation = rotPlanner.createRotationPlan('field-1', 'Rice-Wheat-Legume', {\n        nitrogenLevel: 'balanced',\n        organicMatterTrend: 'stable',\n        soilStructure: 'good',\n        microbiologicalActivity: 60,\n        compactionRisk: 40,\n      });\n      expect(rotation?.crops.length).toBe(3);\n    });\n  });\n});\n
