import React, { useState } from 'react';\nimport { Clock, Plus, Trash2, Edit2, Play, Pause } from 'lucide-react';\n\nexport interface ScheduledReport {\n  id: string;\n  name: string;\n  reportType: string;\n  schedule: string; // cron expression\n  recipients: string[];\n  format: 'pdf' | 'excel' | 'csv' | 'json';\n  enabled: boolean;\n  lastRun?: number;\n  nextRun?: number;\n  createdAt: number;\n}\n\nconst cronPresets = [\n  { label: 'Every Day at 9 AM', value: '0 9 * * *' },\n  { label: 'Every Monday at 9 AM', value: '0 9 * * 1' },\n  { label: 'Every 1st of Month at 9 AM', value: '0 9 1 * *' },\n  { label: 'Every Hour', value: '0 * * * *' },\n  { label: 'Every 6 Hours', value: '0 */6 * * *' },\n  { label: 'Every 30 Minutes', value: '*/30 * * * *' },\n  { label: 'Monday-Friday at 8 AM', value: '0 8 * * 1-5' },\n  { label: 'Every Sunday at 12 PM', value: '0 12 * * 0' },\n];\n\nconst reportTypes = [\n  { value: 'financial', label: 'Financial Report' },\n  { value: 'operational', label: 'Operational Report' },\n  { value: 'yield', label: 'Yield Analysis' },\n  { value: 'budget', label: 'Budget vs Actual' },\n  { value: 'forecast', label: 'Forecast Report' },\n  { value: 'compliance', label: 'Compliance Report' },\n];\n\nconst ReportScheduling: React.FC = () => {\n  const [schedules, setSchedules] = useState<ScheduledReport[]>([\n    {\n      id: '1',\n      name: 'Weekly Financial Report',\n      reportType: 'financial',\n      schedule: '0 9 * * 1',\n      recipients: ['manager@farm.com'],\n      format: 'pdf',\n      enabled: true,\n      lastRun: Date.now() - 24 * 60 * 60 * 1000,\n      nextRun: Date.now() + 6 * 24 * 60 * 60 * 1000,\n      createdAt: Date.now() - 30 * 24 * 60 * 60 * 1000,\n    },\n  ]);\n\n  const [showForm, setShowForm] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [formData, setFormData] = useState<Partial<ScheduledReport>>({\n    name: '',\n    reportType: 'financial',\n    schedule: '0 9 * * *',\n    recipients: [],\n    format: 'pdf',\n    enabled: true,\n  });\n\n  const handleAddSchedule = () => {\n    if (!formData.name || !formData.recipients?.length) {\n      alert('Please fill in all required fields');\n      return;\n    }\n\n    if (editingId) {\n      setSchedules(\n        schedules.map((s) =>\n          s.id === editingId\n            ? {\n                ...s,\n                ...formData,\n                updatedAt: Date.now(),\n              }\n            : s\n        )\n      );\n      setEditingId(null);\n    } else {\n      const newSchedule: ScheduledReport = {\n        id: `schedule-${Date.now()}`,\n        name: formData.name || '',\n        reportType: formData.reportType || 'financial',\n        schedule: formData.schedule || '0 9 * * *',\n        recipients: formData.recipients || [],\n        format: formData.format || 'pdf',\n        enabled: formData.enabled !== false,\n        createdAt: Date.now(),\n      };\n\n      setSchedules([...schedules, newSchedule]);\n    }\n\n    setFormData({\n      name: '',\n      reportType: 'financial',\n      schedule: '0 9 * * *',\n      recipients: [],\n      format: 'pdf',\n      enabled: true,\n    });\n    setShowForm(false);\n  };\n\n  const handleDeleteSchedule = (id: string) => {\n    setSchedules(schedules.filter((s) => s.id !== id));\n  };\n\n  const handleToggleSchedule = (id: string) => {\n    setSchedules(\n      schedules.map((s) => (s.id === id ? { ...s, enabled: !s.enabled } : s))\n    );\n  };\n\n  const handleEditSchedule = (schedule: ScheduledReport) => {\n    setFormData(schedule);\n    setEditingId(schedule.id);\n    setShowForm(true);\n  };\n\n  const handleAddRecipient = (email: string) => {\n    if (email && !formData.recipients?.includes(email)) {\n      setFormData({\n        ...formData,\n        recipients: [...(formData.recipients || []), email],\n      });\n    }\n  };\n\n  const handleRemoveRecipient = (email: string) => {\n    setFormData({\n      ...formData,\n      recipients: formData.recipients?.filter((r) => r !== email),\n    });\n  };\n\n  const getCronDescription = (cron: string): string => {\n    const preset = cronPresets.find((p) => p.value === cron);\n    return preset?.label || cron;\n  };\n\n  const formatDate = (timestamp: number): string => {\n    return new Date(timestamp).toLocaleString();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Report Scheduling</h1>\n            <p className=\"text-gray-600 mt-2\">Automate report generation and delivery</p>\n          </div>\n          <button\n            onClick={() => {\n              setShowForm(!showForm);\n              setEditingId(null);\n              setFormData({\n                name: '',\n                reportType: 'financial',\n                schedule: '0 9 * * *',\n                recipients: [],\n                format: 'pdf',\n                enabled: true,\n              });\n            }}\n            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            <Plus size={20} />\n            New Schedule\n          </button>\n        </div>\n\n        {/* Form */}\n        {showForm && (\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-8\">\n            <h2 className=\"text-xl font-semibold mb-6\">\n              {editingId ? 'Edit Schedule' : 'Create New Schedule'}\n            </h2>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n              {/* Name */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Schedule Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name || ''}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"e.g., Weekly Financial Report\"\n                />\n              </div>\n\n              {/* Report Type */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Report Type\n                </label>\n                <select\n                  value={formData.reportType || 'financial'}\n                  onChange={(e) => setFormData({ ...formData, reportType: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  {reportTypes.map((type) => (\n                    <option key={type.value} value={type.value}>\n                      {type.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Schedule */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Schedule (Cron)\n                </label>\n                <select\n                  value={formData.schedule || '0 9 * * *'}\n                  onChange={(e) => setFormData({ ...formData, schedule: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  {cronPresets.map((preset) => (\n                    <option key={preset.value} value={preset.value}>\n                      {preset.label}\n                    </option>\n                  ))}\n                </select>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {getCronDescription(formData.schedule || '0 9 * * *')}\n                </p>\n              </div>\n\n              {/* Format */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Export Format\n                </label>\n                <select\n                  value={formData.format || 'pdf'}\n                  onChange={(e) => setFormData({ ...formData, format: e.target.value as any })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"pdf\">PDF</option>\n                  <option value=\"excel\">Excel</option>\n                  <option value=\"csv\">CSV</option>\n                  <option value=\"json\">JSON</option>\n                </select>\n              </div>\n            </div>\n\n            {/* Recipients */}\n            <div className=\"mt-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Recipients\n              </label>\n              <div className=\"flex gap-2 mb-3\">\n                <input\n                  type=\"email\"\n                  id=\"recipient-input\"\n                  placeholder=\"Enter email address\"\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <button\n                  onClick={() => {\n                    const input = document.getElementById('recipient-input') as HTMLInputElement;\n                    if (input?.value) {\n                      handleAddRecipient(input.value);\n                      input.value = '';\n                    }\n                  }}\n                  className=\"px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors\"\n                >\n                  Add\n                </button>\n              </div>\n              <div className=\"flex flex-wrap gap-2\">\n                {formData.recipients?.map((recipient) => (\n                  <div\n                    key={recipient}\n                    className=\"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-900 rounded-full text-sm\"\n                  >\n                    {recipient}\n                    <button\n                      onClick={() => handleRemoveRecipient(recipient)}\n                      className=\"text-blue-600 hover:text-blue-800\"\n                    >\n                      Ã—\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={handleAddSchedule}\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\n              >\n                {editingId ? 'Update Schedule' : 'Create Schedule'}\n              </button>\n              <button\n                onClick={() => {\n                  setShowForm(false);\n                  setEditingId(null);\n                }}\n                className=\"flex-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors font-medium\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Schedules List */}\n        <div className=\"space-y-4\">\n          {schedules.map((schedule) => (\n            <div\n              key={schedule.id}\n              className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\"\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <Clock size={20} className=\"text-blue-600\" />\n                    <h3 className=\"text-lg font-semibold text-gray-900\">{schedule.name}</h3>\n                    {!schedule.enabled && (\n                      <span className=\"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded font-medium\">\n                        Disabled\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4 mt-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-600\">Report Type</p>\n                      <p className=\"font-medium text-gray-900\">\n                        {reportTypes.find((t) => t.value === schedule.reportType)?.label}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">Schedule</p>\n                      <p className=\"font-medium text-gray-900\">{getCronDescription(schedule.schedule)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">Format</p>\n                      <p className=\"font-medium text-gray-900 uppercase\">{schedule.format}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">Recipients</p>\n                      <p className=\"font-medium text-gray-900\">{schedule.recipients.length} recipient(s)</p>\n                    </div>\n                  </div>\n\n                  {schedule.lastRun && (\n                    <p className=\"text-xs text-gray-500 mt-3\">\n                      Last run: {formatDate(schedule.lastRun)}\n                    </p>\n                  )}\n                  {schedule.nextRun && (\n                    <p className=\"text-xs text-gray-500\">\n                      Next run: {formatDate(schedule.nextRun)}\n                    </p>\n                  )}\n                </div>\n\n                <div className=\"flex items-center gap-2 ml-4\">\n                  <button\n                    onClick={() => handleToggleSchedule(schedule.id)}\n                    className={`p-2 rounded-lg transition-colors ${\n                      schedule.enabled\n                        ? 'bg-green-100 text-green-600 hover:bg-green-200'\n                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                    }`}\n                    title={schedule.enabled ? 'Pause' : 'Resume'}\n                  >\n                    {schedule.enabled ? <Play size={18} /> : <Pause size={18} />}\n                  </button>\n                  <button\n                    onClick={() => handleEditSchedule(schedule)}\n                    className=\"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors\"\n                    title=\"Edit\"\n                  >\n                    <Edit2 size={18} />\n                  </button>\n                  <button\n                    onClick={() => handleDeleteSchedule(schedule.id)}\n                    className=\"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors\"\n                    title=\"Delete\"\n                  >\n                    <Trash2 size={18} />\n                  </button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {schedules.length === 0 && !showForm && (\n          <div className=\"text-center py-12\">\n            <Clock size={48} className=\"mx-auto text-gray-400 mb-4\" />\n            <p className=\"text-gray-600 mb-4\">No scheduled reports yet</p>\n            <button\n              onClick={() => setShowForm(true)}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              Create First Schedule\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ReportScheduling;\n
