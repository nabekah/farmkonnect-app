import React, { useState, useEffect } from 'react';\nimport { useAuth } from '@/lib/auth';\nimport { trpc } from '@/lib/trpc';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowUp, ArrowDown, TrendingUp, AlertCircle, CheckCircle, Clock } from 'lucide-react';\n\nexport interface MobileMetric {\n  label: string;\n  value: string | number;\n  unit?: string;\n  trend?: 'up' | 'down' | 'stable';\n  trendValue?: number;\n  status?: 'success' | 'warning' | 'error';\n}\n\nexport interface MobileAlert {\n  id: string;\n  title: string;\n  message: string;\n  severity: 'info' | 'warning' | 'error';\n  timestamp: number;\n  actionUrl?: string;\n}\n\nexport interface MobileDashboardData {\n  metrics: MobileMetric[];\n  alerts: MobileAlert[];\n  recentActivities: {\n    id: string;\n    type: string;\n    description: string;\n    timestamp: number;\n  }[];\n  quickActions: {\n    id: string;\n    label: string;\n    icon: string;\n    action: string;\n  }[];\n}\n\n/**\n * Mobile Dashboard Component\n */\nexport const MobileDashboard: React.FC = () => {\n  const { user } = useAuth();\n  const [dashboardData, setDashboardData] = useState<MobileDashboardData | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [selectedAlert, setSelectedAlert] = useState<MobileAlert | null>(null);\n  const [refreshing, setRefreshing] = useState(false);\n\n  // Fetch dashboard data\n  useEffect(() => {\n    if (user?.id) {\n      loadDashboardData();\n    }\n  }, [user?.id]);\n\n  const loadDashboardData = async () => {\n    try {\n      setIsLoading(true);\n      // Mock data for mobile dashboard\n      const mockData: MobileDashboardData = {\n        metrics: [\n          {\n            label: 'Total Revenue',\n            value: 125000,\n            unit: '$',\n            trend: 'up',\n            trendValue: 12.5,\n            status: 'success',\n          },\n          {\n            label: 'Net Profit',\n            value: 45000,\n            unit: '$',\n            trend: 'up',\n            trendValue: 8.3,\n            status: 'success',\n          },\n          {\n            label: 'Profit Margin',\n            value: 36,\n            unit: '%',\n            trend: 'stable',\n            status: 'success',\n          },\n          {\n            label: 'Active Tasks',\n            value: 12,\n            trend: 'down',\n            trendValue: 2.1,\n            status: 'warning',\n          },\n        ],\n        alerts: [\n          {\n            id: 'alert-1',\n            title: 'Inventory Low',\n            message: 'Wheat seeds inventory below reorder threshold',\n            severity: 'warning',\n            timestamp: Date.now() - 3600000,\n          },\n          {\n            id: 'alert-2',\n            title: 'Weather Alert',\n            message: 'Heavy rain expected in 24 hours',\n            severity: 'info',\n            timestamp: Date.now() - 1800000,\n          },\n          {\n            id: 'alert-3',\n            title: 'Task Overdue',\n            message: 'Fertilizer application task is overdue',\n            severity: 'error',\n            timestamp: Date.now() - 7200000,\n          },\n        ],\n        recentActivities: [\n          {\n            id: 'act-1',\n            type: 'harvest',\n            description: 'Harvested 500 kg of wheat from Field A',\n            timestamp: Date.now() - 86400000,\n          },\n          {\n            id: 'act-2',\n            type: 'maintenance',\n            description: 'Equipment maintenance completed',\n            timestamp: Date.now() - 172800000,\n          },\n          {\n            id: 'act-3',\n            type: 'order',\n            description: 'Fertilizer order placed with Supplier B',\n            timestamp: Date.now() - 259200000,\n          },\n        ],\n        quickActions: [\n          { id: 'qa-1', label: 'New Task', icon: 'plus', action: 'create_task' },\n          { id: 'qa-2', label: 'View Alerts', icon: 'bell', action: 'view_alerts' },\n          { id: 'qa-3', label: 'Reports', icon: 'chart', action: 'view_reports' },\n          { id: 'qa-4', label: 'Settings', icon: 'settings', action: 'open_settings' },\n        ],\n      };\n      setDashboardData(mockData);\n    } catch (error) {\n      console.error('Failed to load dashboard data:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    await loadDashboardData();\n    setRefreshing(false);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 p-4 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-slate-300 border-t-primary\"></div>\n          <p className=\"mt-4 text-slate-600\">Loading dashboard...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 pb-20\">\n      {/* Header */}\n      <div className=\"sticky top-0 z-40 bg-white border-b border-slate-200 shadow-sm\">\n        <div className=\"px-4 py-4 flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-xl font-bold text-slate-900\">Farm Dashboard</h1>\n            <p className=\"text-sm text-slate-500\">Welcome, {user?.name || 'Farmer'}</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleRefresh}\n            disabled={refreshing}\n            className=\"h-10 w-10 p-0\"\n          >\n            <TrendingUp className={`h-5 w-5 ${refreshing ? 'animate-spin' : ''}`} />\n          </Button>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"px-4 py-6 space-y-6\">\n        {/* Key Metrics */}\n        <section>\n          <h2 className=\"text-lg font-semibold text-slate-900 mb-3\">Key Metrics</h2>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {dashboardData?.metrics.map((metric) => (\n              <Card key={metric.label} className=\"bg-white\">\n                <CardContent className=\"p-3\">\n                  <p className=\"text-xs text-slate-500 font-medium mb-1\">{metric.label}</p>\n                  <div className=\"flex items-end justify-between\">\n                    <div>\n                      <p className=\"text-lg font-bold text-slate-900\">\n                        {typeof metric.value === 'number' && metric.value > 1000\n                          ? (metric.value / 1000).toFixed(1) + 'k'\n                          : metric.value}\n                        {metric.unit && <span className=\"text-sm text-slate-500 ml-1\">{metric.unit}</span>}\n                      </p>\n                    </div>\n                    {metric.trend && (\n                      <div className=\"flex items-center gap-1\">\n                        {metric.trend === 'up' && (\n                          <>\n                            <ArrowUp className=\"h-4 w-4 text-green-600\" />\n                            <span className=\"text-xs text-green-600 font-semibold\">{metric.trendValue}%</span>\n                          </>\n                        )}\n                        {metric.trend === 'down' && (\n                          <>\n                            <ArrowDown className=\"h-4 w-4 text-red-600\" />\n                            <span className=\"text-xs text-red-600 font-semibold\">{metric.trendValue}%</span>\n                          </>\n                        )}\n                        {metric.trend === 'stable' && <span className=\"text-xs text-slate-500\">Stable</span>}\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </section>\n\n        {/* Alerts Section */}\n        {dashboardData && dashboardData.alerts.length > 0 && (\n          <section>\n            <h2 className=\"text-lg font-semibold text-slate-900 mb-3\">Alerts</h2>\n            <div className=\"space-y-2\">\n              {dashboardData.alerts.map((alert) => (\n                <Card\n                  key={alert.id}\n                  className={`bg-white cursor-pointer transition-all ${\n                    selectedAlert?.id === alert.id ? 'ring-2 ring-primary' : ''\n                  }`}\n                  onClick={() => setSelectedAlert(selectedAlert?.id === alert.id ? null : alert)}\n                >\n                  <CardContent className=\"p-3\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"mt-1\">\n                        {alert.severity === 'error' && <AlertCircle className=\"h-5 w-5 text-red-600\" />}\n                        {alert.severity === 'warning' && <AlertCircle className=\"h-5 w-5 text-amber-600\" />}\n                        {alert.severity === 'info' && <CheckCircle className=\"h-5 w-5 text-blue-600\" />}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-semibold text-slate-900 text-sm\">{alert.title}</p>\n                        <p className=\"text-xs text-slate-600 mt-1\">{alert.message}</p>\n                        <p className=\"text-xs text-slate-400 mt-2\">\n                          {new Date(alert.timestamp).toLocaleTimeString()}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </section>\n        )}\n\n        {/* Quick Actions */}\n        <section>\n          <h2 className=\"text-lg font-semibold text-slate-900 mb-3\">Quick Actions</h2>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {dashboardData?.quickActions.map((action) => (\n              <Button\n                key={action.id}\n                variant=\"outline\"\n                className=\"h-auto py-4 flex flex-col items-center justify-center gap-2 border-slate-200 hover:bg-slate-50\"\n              >\n                <div className=\"text-2xl\">ðŸ“±</div>\n                <span className=\"text-xs font-medium text-slate-900\">{action.label}</span>\n              </Button>\n            ))}\n          </div>\n        </section>\n\n        {/* Recent Activities */}\n        <section>\n          <h2 className=\"text-lg font-semibold text-slate-900 mb-3\">Recent Activities</h2>\n          <Card className=\"bg-white\">\n            <CardContent className=\"p-0\">\n              <div className=\"divide-y divide-slate-200\">\n                {dashboardData?.recentActivities.map((activity) => (\n                  <div key={activity.id} className=\"p-3 flex items-start gap-3\">\n                    <Clock className=\"h-5 w-5 text-slate-400 mt-0.5 flex-shrink-0\" />\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium text-slate-900 capitalize\">{activity.type}</p>\n                      <p className=\"text-xs text-slate-600 mt-1\">{activity.description}</p>\n                      <p className=\"text-xs text-slate-400 mt-2\">\n                        {new Date(activity.timestamp).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </section>\n      </div>\n    </div>\n  );\n};\n\nexport default MobileDashboard;\n
