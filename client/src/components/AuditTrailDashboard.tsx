import React, { useState, useMemo } from 'react';\nimport { Download, Filter, Search, AlertCircle, CheckCircle, Clock, Trash2 } from 'lucide-react';\n\nexport interface AuditLogItem {\n  id: string;\n  userId: string;\n  username: string;\n  action: string;\n  resourceType: string;\n  resourceId: string;\n  resourceName?: string;\n  severity: 'info' | 'warning' | 'critical';\n  status: 'success' | 'failure';\n  errorMessage?: string;\n  timestamp: number;\n  duration?: number;\n}\n\nexport interface AuditStatisticsData {\n  totalLogs: number;\n  successRate: number;\n  criticalActionsCount: number;\n  averageActionDuration: number;\n  logsByAction: Record<string, number>;\n  logsBySeverity: Record<string, number>;\n}\n\ninterface AuditTrailDashboardProps {\n  logs: AuditLogItem[];\n  statistics: AuditStatisticsData;\n  onExport: (format: 'csv' | 'json') => void;\n  onGenerateReport: (filters: any) => void;\n  onDeleteLogs: (days: number) => void;\n}\n\nconst AuditTrailDashboard: React.FC<AuditTrailDashboardProps> = ({\n  logs,\n  statistics,\n  onExport,\n  onGenerateReport,\n  onDeleteLogs,\n}) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filterAction, setFilterAction] = useState<string>('');\n  const [filterSeverity, setFilterSeverity] = useState<string>('');\n  const [filterStatus, setFilterStatus] = useState<string>('');\n  const [sortBy, setSortBy] = useState<'timestamp' | 'duration' | 'action'>('timestamp');\n  const [showFilters, setShowFilters] = useState(false);\n\n  const filteredLogs = useMemo(() => {\n    let filtered = [...logs];\n\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      filtered = filtered.filter(\n        (log) =>\n          log.username.toLowerCase().includes(query) ||\n          log.action.toLowerCase().includes(query) ||\n          log.resourceType.toLowerCase().includes(query) ||\n          log.resourceName?.toLowerCase().includes(query)\n      );\n    }\n\n    if (filterAction) {\n      filtered = filtered.filter((log) => log.action === filterAction);\n    }\n\n    if (filterSeverity) {\n      filtered = filtered.filter((log) => log.severity === filterSeverity);\n    }\n\n    if (filterStatus) {\n      filtered = filtered.filter((log) => log.status === filterStatus);\n    }\n\n    // Sort\n    filtered.sort((a, b) => {\n      switch (sortBy) {\n        case 'timestamp':\n          return b.timestamp - a.timestamp;\n        case 'duration':\n          return (b.duration || 0) - (a.duration || 0);\n        case 'action':\n          return a.action.localeCompare(b.action);\n        default:\n          return 0;\n      }\n    });\n\n    return filtered;\n  }, [logs, searchQuery, filterAction, filterSeverity, filterStatus, sortBy]);\n\n  const getSeverityColor = (severity: string): string => {\n    switch (severity) {\n      case 'critical':\n        return 'bg-red-100 text-red-800';\n      case 'warning':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-blue-100 text-blue-800';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    return status === 'success' ? (\n      <CheckCircle size={16} className=\"text-green-600\" />\n    ) : (\n      <AlertCircle size={16} className=\"text-red-600\" />\n    );\n  };\n\n  const actionOptions = useMemo(() => {\n    const actions = new Set(logs.map((l) => l.action));\n    return Array.from(actions).sort();\n  }, [logs]);\n\n  return (\n    <div className=\"w-full bg-white rounded-lg border border-slate-200 p-4\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold mb-2\">Audit Trail</h1>\n        <p className=\"text-slate-600\">Track all system activities and changes</p>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n        <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\n          <div className=\"text-sm text-slate-600 mb-1\">Total Logs</div>\n          <div className=\"text-2xl font-bold text-blue-600\">{statistics.totalLogs}</div>\n        </div>\n        <div className=\"p-4 bg-green-50 rounded-lg border border-green-200\">\n          <div className=\"text-sm text-slate-600 mb-1\">Success Rate</div>\n          <div className=\"text-2xl font-bold text-green-600\">{statistics.successRate.toFixed(1)}%</div>\n        </div>\n        <div className=\"p-4 bg-red-50 rounded-lg border border-red-200\">\n          <div className=\"text-sm text-slate-600 mb-1\">Critical Actions</div>\n          <div className=\"text-2xl font-bold text-red-600\">{statistics.criticalActionsCount}</div>\n        </div>\n        <div className=\"p-4 bg-purple-50 rounded-lg border border-purple-200\">\n          <div className=\"text-sm text-slate-600 mb-1\">Avg Duration</div>\n          <div className=\"text-2xl font-bold text-purple-600\">\n            {statistics.averageActionDuration.toFixed(0)}ms\n          </div>\n        </div>\n      </div>\n\n      {/* Search and Filters */}\n      <div className=\"mb-4\">\n        <div className=\"flex gap-2 mb-3\">\n          <div className=\"flex-1 relative\">\n            <Search size={18} className=\"absolute left-3 top-2.5 text-slate-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search by user, action, or resource...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n          <button\n            onClick={() => setShowFilters(!showFilters)}\n            className=\"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 flex items-center gap-2\"\n          >\n            <Filter size={18} />\n            Filters\n          </button>\n        </div>\n\n        {/* Filter Panel */}\n        {showFilters && (\n          <div className=\"p-4 bg-slate-50 rounded-lg border border-slate-200 mb-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <label className=\"block text-sm font-semibold mb-2\">Action</label>\n                <select\n                  value={filterAction}\n                  onChange={(e) => setFilterAction(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"\">All Actions</option>\n                  {actionOptions.map((action) => (\n                    <option key={action} value={action}>\n                      {action}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-semibold mb-2\">Severity</label>\n                <select\n                  value={filterSeverity}\n                  onChange={(e) => setFilterSeverity(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"\">All Severities</option>\n                  <option value=\"info\">Info</option>\n                  <option value=\"warning\">Warning</option>\n                  <option value=\"critical\">Critical</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-semibold mb-2\">Status</label>\n                <select\n                  value={filterStatus}\n                  onChange={(e) => setFilterStatus(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"\">All Statuses</option>\n                  <option value=\"success\">Success</option>\n                  <option value=\"failure\">Failure</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Sort and Actions */}\n      <div className=\"flex gap-2 mb-4\">\n        <select\n          value={sortBy}\n          onChange={(e) => setSortBy(e.target.value as any)}\n          className=\"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        >\n          <option value=\"timestamp\">Sort by Timestamp</option>\n          <option value=\"duration\">Sort by Duration</option>\n          <option value=\"action\">Sort by Action</option>\n        </select>\n\n        <div className=\"flex gap-2 ml-auto\">\n          <button\n            onClick={() => onExport('csv')}\n            className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2\"\n          >\n            <Download size={18} />\n            Export CSV\n          </button>\n          <button\n            onClick={() => onExport('json')}\n            className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2\"\n          >\n            <Download size={18} />\n            Export JSON\n          </button>\n        </div>\n      </div>\n\n      {/* Logs Table */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full text-sm\">\n          <thead>\n            <tr className=\"border-b border-slate-200 bg-slate-50\">\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Timestamp</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">User</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Action</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Resource</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Severity</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Status</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-slate-700\">Duration</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filteredLogs.length > 0 ? (\n              filteredLogs.map((log) => (\n                <tr key={log.id} className=\"border-b border-slate-200 hover:bg-slate-50\">\n                  <td className=\"px-4 py-3 text-slate-600\">\n                    {new Date(log.timestamp).toLocaleString()}\n                  </td>\n                  <td className=\"px-4 py-3 font-medium text-slate-900\">{log.username}</td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-semibold\">\n                      {log.action}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-600\">\n                    <div className=\"text-xs\">{log.resourceType}</div>\n                    {log.resourceName && <div className=\"text-xs text-slate-500\">{log.resourceName}</div>}\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className={`px-2 py-1 rounded text-xs font-semibold ${getSeverityColor(log.severity)}`}>\n                      {log.severity}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3 flex items-center gap-2\">\n                    {getStatusIcon(log.status)}\n                    <span className=\"capitalize\">{log.status}</span>\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-600\">\n                    {log.duration ? (\n                      <div className=\"flex items-center gap-1\">\n                        <Clock size={14} />\n                        {log.duration}ms\n                      </div>\n                    ) : (\n                      '-'\n                    )}\n                  </td>\n                </tr>\n              ))\n            ) : (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center text-slate-500\">\n                  No logs found matching your filters\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Pagination Info */}\n      <div className=\"mt-4 text-sm text-slate-600\">\n        Showing {filteredLogs.length} of {logs.length} logs\n      </div>\n\n      {/* Maintenance Section */}\n      <div className=\"mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200\">\n        <h3 className=\"font-semibold text-yellow-900 mb-3 flex items-center gap-2\">\n          <AlertCircle size={18} />\n          Maintenance\n        </h3>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => onDeleteLogs(30)}\n            className=\"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 flex items-center gap-2 text-sm\"\n          >\n            <Trash2 size={16} />\n            Clear logs older than 30 days\n          </button>\n          <button\n            onClick={() => onDeleteLogs(90)}\n            className=\"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 flex items-center gap-2 text-sm\"\n          >\n            <Trash2 size={16} />\n            Clear logs older than 90 days\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AuditTrailDashboard;\n
